<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>PlanSee - AI Interior Design Studio</title>

  <!-- Inter font + Tailwind -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --grad-a:#667eea;
      --grad-b:#764ba2;
      --grad-c:#f093fb;
    }
    html,body{font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;}
    .hero-gradient{background:linear-gradient(135deg,var(--grad-a) 0%,var(--grad-b) 55%,var(--grad-c) 100%);}
    .glass{background:rgba(255,255,255,.12);backdrop-filter:blur(18px);border:1px solid rgba(255,255,255,.2);}
    .card-hover{transition:transform .35s cubic-bezier(.4,0,.2,1), box-shadow .35s;}
    .card-hover:hover{transform:translateY(-6px) scale(1.01); box-shadow:0 22px 45px rgba(0,0,0,.12);}
    .dot{animation:bdot 1.1s infinite}
    .dot:nth-child(2){animation-delay:.12s}
    .dot:nth-child(3){animation-delay:.24s}
    @keyframes bdot{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-6px)}}
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen">

  <!-- ========== HERO ========== -->
  <header class="hero-gradient relative overflow-hidden">
    <div class="absolute inset-0 bg-black/20"></div>
    <div class="relative z-10 container mx-auto px-6 py-12 text-center">
      <h1 class="text-5xl md:text-6xl font-black text-white mb-2">PlanSee</h1>
      <p class="text-xl md:text-2xl text-white/90 font-medium">AI Interior Design Studio</p>
    </div>
  </header>

  <main class="container mx-auto px-6 -mt-16 relative z-20">

    <!-- ========== STEP 1 Interview ========== -->
    <section id="step-1" class="mb-12">
      <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-purple-600 via-pink-600 to-red-500 p-8 text-white text-center">
          <h2 class="text-4xl font-bold mb-2">Client Consultation</h2>
        </div>

        <div class="p-8 md:p-12 text-center">
          <button id="btn-record" class="px-10 py-5 text-2xl rounded-2xl font-bold text-white shadow-2xl bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700">
            Start Recording
          </button>
          <div id="timer" class="text-3xl font-bold mt-6 text-red-600">00:00</div>
          <div id="recording-status" class="mt-3 text-gray-600"></div>
        </div>
      </div>
    </section>

    <!-- ========== STEP 2: Space Survey ========== -->
    <section id="step-2" class="mb-12 hidden">
      <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 p-8 text-white text-center">
          <h2 class="text-4xl font-bold mb-1">Space Survey & Measurements</h2>
          <p class="opacity-90">Upload floor plans and provide dimensions</p>
        </div>

        <div class="p-8 md:p-12">
          <div class="max-w-4xl mx-auto space-y-10">
            <!-- Upload box -->
            <div class="text-center border-2 border-dashed border-blue-300 rounded-3xl p-10 bg-gradient-to-br from-blue-50 to-indigo-50 card-hover">
              <h3 class="text-2xl font-bold text-gray-800 mb-2">Upload Floor Plans</h3>
              <input id="files" type="file" class="hidden" multiple accept="image/*,.pdf,.dwg,.dxf" />
              <button onclick="document.getElementById('files').click()" class="px-6 py-3 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700">Select Files</button>
              <p class="text-sm text-gray-500 mt-3">Supported: JPG, PNG, PDF, DWG, DXF (Max 10MB each)</p>
            </div>
            <div id="uploaded-wrap" class="hidden">
              <h4 class="text-xl font-bold text-emerald-900 mb-3">Files Uploaded:</h4>
              <div id="files-list" class="space-y-2"></div>
            </div>

            <!-- Dimensions -->
            <div class="bg-gradient-to-br from-gray-50 to-slate-100 rounded-3xl p-8 shadow-lg">
              <h3 class="text-2xl font-bold text-gray-800 text-center mb-6">Room Dimensions</h3>
              <div class="grid md:grid-cols-3 gap-6">
                <input id="dim-length" type="number" step="0.1" placeholder="Length (m)" class="p-4 rounded-xl border-2 border-gray-300 w-full" />
                <input id="dim-width" type="number" step="0.1" placeholder="Width (m)" class="p-4 rounded-xl border-2 border-gray-300 w-full" />
                <input id="dim-height" type="number" step="0.1" placeholder="Height (m)" class="p-4 rounded-xl border-2 border-gray-300 w-full" />
              </div>
            </div>

            <div class="text-center">
              <button id="btn-next2" class="px-8 py-4 text-2xl rounded-2xl text-white font-bold shadow-2xl bg-gradient-to-r from-purple-600 to-pink-600">Generate AI Designs</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ========== STEP 3: Proposals ========== -->
    <section id="step-3" class="hidden">
      <div id="loading" class="bg-white rounded-3xl shadow-2xl p-12 text-center">
        <h3 class="text-3xl font-bold text-gray-800 mb-2">Creating Your Perfect Designs...</h3>
      </div>
      <div id="proposals" class="hidden">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden p-10">
          <h2 class="text-4xl font-bold mb-6 text-center">Your AI Proposals</h2>
          <div id="grid" class="grid md:grid-cols-2 gap-8"></div>
        </div>
      </div>
    </section>

  </main>

  <!-- ========== SCRIPT ========== -->
  <script>
    /* ========= Webhook ========= */
    const N8N_WEBHOOK_URL = "https://plansee.app.n8n.cloud/webhook/958b5b14-1f45-4701-839e-16f392138f8d"; 

    async function sendToN8N(action, data, filesFormData){
      try{
        if(filesFormData){
          filesFormData.append("action", action);
          const res = await fetch(N8N_WEBHOOK_URL, { method:"POST", body: filesFormData });
          return await res.text();
        }
        const res = await fetch(N8N_WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action, ...data })
        });
        return await res.text();
      }catch(e){ console.warn("n8n error:", e); }
    }

    /* ========= Recording ========= */
    let mediaRecorder, audioChunks = [];
    let recording = false;
    const recordBtn = document.getElementById("btn-record");
    const timerEl = document.getElementById("timer");
    const statusEl = document.getElementById("recording-status");
    let timerInterval, startTime;

    function formatTime(sec){ const m=Math.floor(sec/60),s=sec%60; return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`; }

    recordBtn.addEventListener("click", async ()=>{
      if(!recording){
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
          mediaRecorder = new MediaRecorder(stream);
          audioChunks = [];
          mediaRecorder.ondataavailable = e => { if(e.data.size > 0) audioChunks.push(e.data); };
          mediaRecorder.onstop = async ()=>{
            const audioBlob = new Blob(audioChunks, { type:"audio/webm" });
            const fd = new FormData();
            fd.append("audio", audioBlob, "interview.webm");
            await sendToN8N("interview_audio", {}, fd);
            statusEl.textContent = "Recording sent âœ…";
          };
          mediaRecorder.start();
          recording = true;
          recordBtn.innerText = "Stop Recording";
          statusEl.textContent = "Recording...";
          startTime = Date.now();
          timerInterval = setInterval(()=>{ timerEl.textContent = formatTime(Math.floor((Date.now()-startTime)/1000)); },1000);
        } catch(err){ alert("Mic error: "+err.message); }
      } else {
        mediaRecorder.stop();
        clearInterval(timerInterval);
        recordBtn.innerText = "Start Recording";
        recording = false;
        statusEl.textContent = "Stopped";
      }
    });
  </script>
</body>
</html>
