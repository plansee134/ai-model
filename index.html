<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>PlanSee - AI Interior Design Studio</title>

  <!-- Inter font + Tailwind -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --grad-a:#667eea; /* indigo-400 */
      --grad-b:#764ba2; /* purple-ish */
      --grad-c:#f093fb; /* pink-ish */
    }
    html,body{font-family:'Inter',system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';}
    .hero-gradient{background:linear-gradient(135deg,var(--grad-a) 0%,var(--grad-b) 55%,var(--grad-c) 100%);}
    .glass{background:rgba(255,255,255,.12);backdrop-filter:blur(18px);border:1px solid rgba(255,255,255,.2);}
    .card-hover{transition:transform .35s cubic-bezier(.4,0,.2,1), box-shadow .35s;}
    .card-hover:hover{transform:translateY(-6px) scale(1.01); box-shadow:0 22px 45px rgba(0,0,0,.12);}
    .float {animation:float 6s ease-in-out infinite}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-14px)}}
    .ring-pulse{animation:ring 1.9s cubic-bezier(.455,.03,.515,.955) infinite;}
    @keyframes ring{0%{transform:scale(.8);opacity:1}80%,100%{transform:scale(1.2);opacity:0}}
    .dot{animation:bdot 1.1s infinite}
    .dot:nth-child(2){animation-delay:.12s}
    .dot:nth-child(3){animation-delay:.24s}
    @keyframes bdot{0%,80%,100%{transform:translateY(0)}40%{transform:translateY(-6px)}}
    .shimmer{background:linear-gradient(90deg,#f3f4f6 25%,#e5e7eb 50%,#f3f4f6 75%);background-size:200% 100%;animation:shim 1.8s linear infinite}
    @keyframes shim{0%{background-position:-200% 0}100%{background-position:200% 0}}
  </style>
</head>
<body class="bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 min-h-screen">

  <!-- ========== HERO ========== -->
  <header class="hero-gradient relative overflow-hidden">
    <div class="absolute inset-0 bg-black/20"></div>
    <div class="relative z-10 container mx-auto px-6 py-12">
      <div class="text-center px-4">
        <div class="float inline-block mb-7">
          <div class="w-20 h-20 mx-auto glass rounded-3xl flex items-center justify-center shadow-2xl">
            <!-- stack icon -->
            <svg class="w-12 h-12 text-white" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2 2 7l10 5 10-5-10-5zM2 12l10 5 10-5M2 17l10 5 10-5"/>
            </svg>
          </div>
        </div>
        <h1 class="text-5xl md:text-6xl font-black text-white mb-2 tracking-tight">PlanSee</h1>
        <p class="text-xl md:text-2xl text-white/90 font-medium">AI Interior Design Studio</p>
      </div>
    </div>
    <div class="absolute bottom-0 left-0 right-0 h-28 bg-gradient-to-t from-slate-50 to-transparent"></div>
  </header>

  <main class="container mx-auto px-6 -mt-16 relative z-20">
    <!-- ========== STEPPER (شكل Canva) ========== -->
    <section class="mb-12">
      <div class="bg-white rounded-3xl shadow-2xl p-6 md:p-8">
        <div class="flex items-center justify-between max-w-4xl mx-auto">
          <!-- step 1 -->
          <div class="flex flex-col items-center">
            <div id="pill-1" class="w-14 h-14 rounded-2xl flex items-center justify-center font-bold text-white shadow-md bg-gradient-to-r from-purple-600 to-pink-600">1</div>
            <p class="mt-3 font-semibold text-gray-800">Interview</p>
            <p class="text-sm text-gray-500 -mt-1">Record requirements</p>
          </div>

          <!-- line -->
          <div class="flex-1 h-1 mx-4 md:mx-8 bg-gray-200 rounded-full overflow-hidden">
            <div id="bar-1" class="h-full w-2/5 bg-gradient-to-r from-purple-600 to-pink-600 transition-all duration-700"></div>
          </div>

          <!-- step 2 -->
          <div class="flex flex-col items-center">
            <div id="pill-2" class="w-14 h-14 rounded-2xl flex items-center justify-center font-bold text-gray-400 bg-gray-200 shadow-md">2</div>
            <p class="mt-3 font-semibold text-gray-400">Survey</p>
            <p class="text-sm text-gray-400 -mt-1">Upload measurements</p>
          </div>

          <!-- line -->
          <div class="flex-1 h-1 mx-4 md:mx-8 bg-gray-200 rounded-full overflow-hidden">
            <div id="bar-2" class="h-full w-0 bg-gradient-to-r from-purple-600 to-pink-600 transition-all duration-700"></div>
          </div>

          <!-- step 3 -->
          <div class="flex flex-col items-center">
            <div id="pill-3" class="w-14 h-14 rounded-2xl flex items-center justify-center font-bold text-gray-400 bg-gray-200 shadow-md">3</div>
            <p class="mt-3 font-semibold text-gray-400">Proposals</p>
            <p class="text-sm text-gray-400 -mt-1">Generate proposals</p>
          </div>
        </div>
      </div>
    </section>

    <!-- ========== STEP 1: Interview (شكل Canva) ========== -->
    <section id="step-1" class="mb-12">
      <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-purple-600 via-pink-600 to-red-500 p-8 text-white text-center">
          <h2 class="text-4xl font-bold mb-2">Client Consultation</h2>
        </div>

        <div class="p-8 md:p-12">
          <div class="max-w-4xl mx-auto">
            <!-- mic + CTA -->
            <div class="bg-gradient-to-br from-purple-50 to-pink-50 border border-purple-100 rounded-3xl p-10 mb-8">
              <div class="text-center space-y-8">
                <div class="relative inline-block">
                  <div class="w-32 h-32 rounded-full shadow-2xl flex items-center justify-center bg-gradient-to-br from-purple-600 to-pink-600">
                    <svg class="w-16 h-16 text-white" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 14a3 3 0 0 0 3-3V6a3 3 0 1 0-6 0v5a3 3 0 0 0 3 3zm5.3-3a5.3 5.3 0 0 1-4.3 5.2V20h2.7a1 1 0 1 1 0 2H8.3a1 1 0 1 1 0-2H11v-3.8A5.3 5.3 0 0 1 6.7 11a1 1 0 1 1 2 0 3.3 3.3 0 1 0 6.6 0 1 1 0 1 1 2 0z"/>
                    </svg>
                  </div>
                  <!-- rings while recording -->
                  <div id="rings" class="absolute inset-0 hidden">
                    <span class="absolute inset-0 rounded-full border-4 border-red-400 ring-pulse"></span>
                    <span class="absolute inset-0 rounded-full border-4 border-red-300 ring-pulse" style="animation-delay:.5s"></span>
                  </div>
                </div>

                <div id="interview-ready" class="space-y-4">
                  <h3 class="text-2xl font-bold text-gray-800">Ready to Begin</h3>
                  <p class="text-gray-600">Click the record button to start your consultation session</p>
                </div>

                <div id="interview-timer" class="hidden space-y-3">
                  <div id="timer" class="text-6xl font-extrabold text-red-600">00:00</div>
                  <div class="flex items-center justify-center gap-2">
                    <span class="w-3 h-3 bg-red-500 rounded-full dot"></span>
                    <span class="w-3 h-3 bg-red-500 rounded-full dot"></span>
                    <span class="w-3 h-3 bg-red-500 rounded-full dot"></span>
                    <span class="text-red-600 font-semibold">Recording…</span>
                  </div>
                </div>

                <div id="interview-done" class="hidden space-y-4">
                  <div class="bg-gradient-to-r from-emerald-50 to-green-50 border border-emerald-200 rounded-2xl p-5">
                    <p class="text-emerald-800 font-semibold">Recording Completed — Duration:
                      <span id="finalDuration" class="font-extrabold"></span>
                    </p>
                  </div>
                  <div class="flex flex-wrap items-center justify-center gap-3">
                    <button id="btn-play" class="px-5 py-3 rounded-xl text-white bg-blue-600 hover:bg-blue-700 font-semibold">Play</button>
                    <button id="btn-rerecord" class="px-5 py-3 rounded-xl text-white bg-gray-600 hover:bg-gray-700 font-semibold">Delete & Re-record</button>
                    <button id="btn-next1" class="px-6 py-3 rounded-xl text-white bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 font-bold">Continue to Space Survey</button>
                  </div>
                </div>

                <!-- CTA button -->
                <button id="btn-record" class="px-10 py-5 text-2xl rounded-2xl font-bold text-white shadow-2xl bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700">
                  <span class="inline-flex items-center gap-3">
                    <svg class="w-7 h-7" viewBox="0 0 24 24" fill="currentColor"><path d="M12 7a1 1 0 0 1 1 1v8a1 1 0 1 1-2 0V8a1 1 0 0 1 1-1zm4 0a1 1 0 0 1 1 1v8a1 1 0 1 1-2 0V8a1 1 0 0 1 1-1zM8 7a1 1 0 0 1 1 1v8a1 1 0 1 1-2 0V8a1 1 0 0 1 1-1z"/></svg>
                    Start Recording
                  </span>
                </button>
              </div>
            </div>

            <!-- Guidelines card -->
            <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-2xl p-8 card-hover">
              <div class="flex items-center gap-3 mb-5">
                <div class="w-11 h-11 rounded-xl flex items-center justify-center bg-gradient-to-r from-amber-500 to-orange-500 text-white">
                  <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M11 7h2v6h-2zm0 8h2v2h-2z"/><path d="M12 2a10 10 0 1 0 .001 20.001A10 10 0 0 0 12 2zm0 18a8 8 0 1 1 .001-16.001A8 8 0 0 1 12 20z"/></svg>
                </div>
                <h4 class="text-2xl font-bold text-amber-900">Interview Guidelines</h4>
              </div>

              <div class="grid md:grid-cols-2 gap-6">
                <ul class="space-y-3">
                  <li class="flex items-start gap-3">
                    <span class="mt-2 w-2 h-2 rounded-full bg-amber-500"></span>
                    <span class="text-amber-800">Discuss room type, dimensions, and spatial needs.</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <span class="mt-2 w-2 h-2 rounded-full bg-amber-500"></span>
                    <span class="text-amber-800">Explore preferred color schemes and styles.</span>
                  </li>
                </ul>
                <ul class="space-y-3">
                  <li class="flex items-start gap-3">
                    <span class="mt-2 w-2 h-2 rounded-full bg-amber-500"></span>
                    <span class="text-amber-800">Capture functional needs and lifestyle patterns.</span>
                  </li>
                  <li class="flex items-start gap-3">
                    <span class="mt-2 w-2 h-2 rounded-full bg-amber-500"></span>
                    <span class="text-amber-800">Share budget and timeline expectations.</span>
                  </li>
                </ul>
              </div>
            </div>

          </div>
        </div>
      </div>
    </section>

    <!-- ========== STEP 2: Space Survey ========== -->
    <section id="step-2" class="mb-12 hidden">
      <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 p-8 text-white text-center">
          <h2 class="text-4xl font-bold mb-1">Space Survey & Measurements</h2>
          <p class="opacity-90">Upload floor plans and provide dimensions</p>
        </div>

        <div class="p-8 md:p-12">
          <div class="max-w-4xl mx-auto space-y-10">
            <!-- Upload box -->
            <div class="text-center border-2 border-dashed border-blue-300 rounded-3xl p-10 bg-gradient-to-br from-blue-50 to-indigo-50 card-hover">
              <div class="w-24 h-24 mx-auto mb-6 rounded-2xl shadow-xl bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center float">
                <svg class="w-12 h-12 text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 0 1-.88-7.903A5 5 0 1 1 15.9 6H16a5 5 0 0 1 1 9.9M15 13l-3-3m0 0-3 3m3-3v12"/>
                </svg>
              </div>
              <h3 class="text-2xl font-bold text-gray-800 mb-2">Upload Floor Plans & Photos</h3>
              <p class="text-gray-600 mb-5">Drag and drop your files or click to browse</p>
              <input id="files" type="file" class="hidden" multiple accept="image/*,.pdf,.dwg,.dxf" />
              <button onclick="document.getElementById('files').click()" class="px-6 py-3 rounded-xl text-white font-bold bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700">Select Files</button>
              <p class="text-sm text-gray-500 mt-3">Supported: JPG, PNG, PDF, DWG, DXF (Max 10MB each)</p>
            </div>

            <div id="uploaded-wrap" class="hidden">
              <div class="bg-gradient-to-r from-emerald-50 to-green-50 border border-emerald-200 rounded-2xl p-6">
                <h4 class="text-xl font-bold text-emerald-900 mb-3 flex items-center gap-2">
                  <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>
                  Files Uploaded
                </h4>
                <div id="files-list" class="space-y-2"></div>
              </div>
            </div>

            <!-- Dimensions -->
            <div class="bg-gradient-to-br from-gray-50 to-slate-100 rounded-3xl p-8 shadow-lg">
              <h3 class="text-2xl font-bold text-gray-800 text-center mb-6">Room Dimensions</h3>
              <div class="grid md:grid-cols-3 gap-6">
                <div>
                  <label class="block font-semibold text-gray-700 mb-2">Length</label>
                  <div class="relative">
                    <input id="dim-length" type="number" step="0.1" placeholder="4.5" class="w-full p-4 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-inner" />
                    <span class="absolute right-4 top-3.5 text-gray-500">m</span>
                  </div>
                </div>
                <div>
                  <label class="block font-semibold text-gray-700 mb-2">Width</label>
                  <div class="relative">
                    <input id="dim-width" type="number" step="0.1" placeholder="3.2" class="w-full p-4 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-inner" />
                    <span class="absolute right-4 top-3.5 text-gray-500">m</span>
                  </div>
                </div>
                <div>
                  <label class="block font-semibold text-gray-700 mb-2">Height</label>
                  <div class="relative">
                    <input id="dim-height" type="number" step="0.1" placeholder="2.8" class="w-full p-4 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white shadow-inner" />
                    <span class="absolute right-4 top-3.5 text-gray-500">m</span>
                  </div>
                </div>
              </div>
            </div>

            <div class="text-center">
              <button id="btn-next2" class="px-8 py-4 text-2xl rounded-2xl text-white font-bold shadow-2xl bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700">Generate AI Designs</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ========== STEP 3: Proposals ========== -->
    <section id="step-3" class="hidden">
      <div id="loading" class="bg-white rounded-3xl shadow-2xl p-12 text-center">
        <div class="max-w-2xl mx-auto">
          <div class="relative w-32 h-32 mx-auto mb-8">
            <div class="absolute inset-0 rounded-full border-8 border-purple-200"></div>
            <div class="absolute inset-0 rounded-full border-8 border-purple-600 border-t-transparent animate-spin"></div>
            <div class="absolute inset-4 rounded-full bg-gradient-to-r from-purple-600 to-pink-600 flex items-center justify-center">
              <svg class="w-12 h-12 text-white" viewBox="0 0 24 24" fill="currentColor"><path d="M12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10z"/></svg>
            </div>
          </div>
          <h3 class="text-3xl font-bold text-gray-800 mb-2">Creating Your Perfect Designs</h3>
          <p class="text-gray-600">Analyzing requirements & generating personalized proposals…</p>
        </div>
      </div>

      <div id="proposals" class="hidden">
        <div class="bg-white rounded-3xl shadow-2xl overflow-hidden">
          <div class="bg-gradient-to-r from-emerald-600 via-teal-600 to-cyan-600 p-8 text-white">
            <div class="flex items-center justify-between">
              <div>
                <h2 class="text-4xl font-bold">Your AI Design Proposals</h2>
                <p class="opacity-90">4 unique concepts tailored to your vision</p>
              </div>
              <div class="flex gap-3">
                <button id="btn-regenerate" class="px-5 py-3 rounded-xl text-white bg-white/20 hover:bg-white/30 backdrop-blur font-semibold">Regenerate</button>
                <button id="btn-download" class="px-5 py-3 rounded-xl text-white bg-white/20 hover:bg-white/30 backdrop-blur font-semibold">Download PDF</button>
              </div>
            </div>
          </div>

          <div class="p-10">
            <div id="grid" class="grid md:grid-cols-2 gap-8"></div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- ========== SCRIPT ========== -->
  <script>
    /* ========= 1) إعداد Webhook ========= */
    const N8N_WEBHOOK_URL = "https://plansee.app.n8n.cloud/webhook/958b5b14-1f45-4701-839e-16f392138f8d"; // بدّليه لو عندك URL مختلف

    async function sendToN8N(action, data, filesFormData){
      try{
        if(filesFormData){
          filesFormData.append("action", action);
          const res = await fetch(N8N_WEBHOOK_URL, { method:"POST", body: filesFormData });
          return await res.text();
        }
        const res = await fetch(N8N_WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ action, ...data })
        });
        return await res.text();
      }catch(e){
        console.warn("n8n error:", e);
      }
    }

    /* ========= 2) Helper UI ========= */
    const step = { current: 1 };
    function setStep(n){
      step.current = n;

      // pills
      [["pill-1",1],["pill-2",2],["pill-3",3]].forEach(([id,idx])=>{
        const el = document.getElementById(id);
        if(idx===n){
          el.className = "w-14 h-14 rounded-2xl flex items-center justify-center font-bold text-white shadow-md bg-gradient-to-r from-purple-600 to-pink-600";
        }else if(idx<n){
          el.className = "w-14 h-14 rounded-2xl flex items-center justify-center font-bold text-white shadow-md bg-gradient-to-r from-green-500 to-emerald-500";
        }else{
          el.className = "w-14 h-14 rounded-2xl flex items-center justify-center font-bold text-gray-400 bg-gray-200 shadow-md";
        }
      });

      // bars
      document.getElementById("bar-1").style.width = (n>1) ? "100%" : "40%";
      document.getElementById("bar-2").style.width = (n>2) ? "100%" : "0%";

      // sections
      ["step-1","step-2","step-3"].forEach((sid,i)=>{
        document.getElementById(sid).classList.toggle("hidden", i+1!==n);
      });
    }

    /* ========= 3) Interview (Recording) ========= */
    const btnRecord = document.getElementById("btn-record");
    const interviewReady = document.getElementById("interview-ready");
    const interviewTimer = document.getElementById("interview-timer");
    const interviewDone  = document.getElementById("interview-done");
    const rings = document.getElementById("rings");
    const timeEl = document.getElementById("timer");
    const finalDurationEl = document.getElementById("finalDuration");

    let mediaRecorder, chunks = [], tInt, startedAt = 0, audioBlob, audioUrl, audioEl;

    function fmt(sec){ const m = Math.floor(sec/60), s = sec%60; return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`; }

    async function startRecording(){
      try{
        const stream = await navigator.mediaDevices.getUserMedia({ audio:true });
        mediaRecorder = new MediaRecorder(stream);
        chunks = [];
        mediaRecorder.ondataavailable = e => e.data.size && chunks.push(e.data);
        mediaRecorder.onstop = async () => {
          audioBlob = new Blob(chunks, { type: "audio/webm" });
          audioUrl = URL.createObjectURL(audioBlob);
          // ابعتيها لـ n8n
          const fd = new FormData();
          fd.append("audio", audioBlob, "interview.webm");
          await sendToN8N("interview_audio", {}, fd);
        };
        mediaRecorder.start();

        // UI
        startedAt = Date.now();
        interviewReady.classList.add("hidden");
        interviewTimer.classList.remove("hidden");
        rings.classList.remove("hidden");
        btnRecord.classList.replace("from-red-500","from-gray-600");
        btnRecord.classList.replace("to-red-600","to-gray-700");
        btnRecord.innerHTML = `<span class="inline-flex items-center gap-3">
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M8 7a1 1 0 0 1 1 1v8a1 1 0 1 1-2 0V8a1 1 0 0 1 1-1zm7 0a1 1 0 0 1 1 1v8a1 1 0 1 1-2 0V8a1 1 0 0 1 1-1z"/></svg>
          Stop Recording
        </span>`;

        // timer
        tInt = setInterval(()=>{
          const sec = Math.floor((Date.now()-startedAt)/1000);
          timeEl.textContent = fmt(sec);
        }, 1000);

        await sendToN8N("interview_start",{ ts: new Date().toISOString() });
      }catch(err){
        alert("Microphone permission denied or not supported. We'll simulate a quick recording.");
        simulateRecording();
      }
    }

    async function stopRecording(){
      clearInterval(tInt);
      const sec = Math.floor((Date.now()-startedAt)/1000) || 8;
      finalDurationEl.textContent = fmt(sec);
      interviewTimer.classList.add("hidden");
      interviewDone.classList.remove("hidden");
      rings.classList.add("hidden");
      btnRecord.classList.add("hidden");

      if(mediaRecorder && mediaRecorder.state!=="inactive") mediaRecorder.stop();
      await sendToN8N("interview_stop",{ duration_sec: sec });
    }

    function simulateRecording(){
      // quick 5s
      startedAt = Date.now();
      interviewReady.classList.add("hidden");
      interviewTimer.classList.remove("hidden");
      rings.classList.remove("hidden");
      btnRecord.textContent = "Stop Recording";
      tInt = setInterval(()=>{
        const sec = Math.min(5, Math.floor((Date.now()-startedAt)/1000));
        timeEl.textContent = fmt(sec);
        if(sec>=5){ stopRecording(); }
      }, 1000);
    }

    btnRecord.addEventListener("click", ()=>{
      if(!mediaRecorder || mediaRecorder.state==="inactive"){ startRecording(); }
      else { stopRecording(); }
    });

    document.getElementById("btn-rerecord").addEventListener("click", ()=>{
      interviewDone.classList.add("hidden");
      interviewReady.classList.remove("hidden");
      btnRecord.classList.remove("hidden");
      btnRecord.classList.replace("from-gray-600","from-red-500");
      btnRecord.classList.replace("to-gray-700","to-red-600");
      btnRecord.innerHTML = `<span class="inline-flex items-center gap-3">
        <svg class="w-7 h-7" viewBox="0 0 24 24" fill="currentColor"><path d="M12 7a1 1 0 0 1 1 1v8a1 1 0 1 1-2 0V8a1 1 0 0 1 1-1z"/></svg> Start Recording
      </span>`;
    });

    document.getElementById("btn-play").addEventListener("click", ()=>{
      if(!audioUrl){ alert("This is a demo: recording preview will play here when available."); return; }
      if(!audioEl){ audioEl = new Audio(audioUrl); }
      audioEl.play();
    });

    document.getElementById("btn-next1").addEventListener("click", async ()=>{
      setStep(2);
      // fill demo dims
      ["dim-length","dim-width","dim-height"].forEach((id,i)=>{
        const v = [4.5,3.2,2.8][i];
        const el = document.getElementById(id);
        el.value = v;
        el.classList.add("bg-green-50");
        setTimeout(()=>el.classList.remove("bg-green-50"), 500);
      });
      await sendToN8N("go_to_survey", {});
    });

    /* ========= 4) Survey (files + dims) ========= */
    const filesInput = document.getElementById("files");
    const uploadedWrap = document.getElementById("uploaded-wrap");
    const filesList = document.getElementById("files-list");

    filesInput.addEventListener("change", async (e)=>{
      const files = Array.from(e.target.files||[]);
      if(!files.length) return;

      uploadedWrap.classList.remove("hidden");
      filesList.innerHTML = "";

      const fd = new FormData();
      files.forEach((f,idx)=>{
        const row = document.createElement("div");
        row.className = "flex items-center justify-between bg-white rounded-xl border border-emerald-200 p-3";
        row.innerHTML = `<div class="flex items-center gap-3">
          <span class="w-9 h-9 rounded-lg bg-green-100 flex items-center justify-center">
            <svg class="w-5 h-5 text-green-600" viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h10l6 6v10H4z"/></svg>
          </span>
          <div><p class="font-medium text-gray-800">${f.name}</p><p class="text-sm text-gray-500">${(f.size/1024/1024).toFixed(2)} MB</p></div>
        </div>
        <span class="text-emerald-600 font-semibold">Queued</span>`;
        filesList.appendChild(row);
        fd.append("file_"+idx, f, f.name);
      });

      await sendToN8N("survey_files", {}, fd);
      // mark as uploaded
      filesList.querySelectorAll("span.text-emerald-600").forEach(s=>s.textContent="Uploaded");
    });

    document.getElementById("btn-next2").addEventListener("click", async ()=>{
      const dims = {
        length: parseFloat(document.getElementById("dim-length").value||0),
        width : parseFloat(document.getElementById("dim-width").value||0),
        height: parseFloat(document.getElementById("dim-height").value||0),
      };
      await sendToN8N("survey_dimensions", dims);

      setStep(3);
      // fake delay → loading → proposals
      document.getElementById("loading").classList.remove("hidden");
      document.getElementById("proposals").classList.add("hidden");
      setTimeout(()=>{ showProposals(); }, 2200);
    });

    /* ========= 5) Proposals ========= */
    const grid = document.getElementById("grid");
    function showProposals(){
      document.getElementById("loading").classList.add("hidden");
      document.getElementById("proposals").classList.remove("hidden");
      grid.innerHTML = "";

      const designs = [
        { title:"Modern Minimalist", desc:"Clean lines, neutral palette, functional calm.", grad:"from-slate-600 to-gray-700",
          icon:"M4 5h16v2H4zM4 11h10v8H4zM16 11h4v8h-4z" },
        { title:"Scandinavian Comfort", desc:"Warm woods, cozy textures, soft light.", grad:"from-amber-500 to-orange-600",
          icon:"M3 4h12v2H3zM3 10h8v8H3zM14 9h6v9h-6z" },
        { title:"Industrial Chic", desc:"Raw materials & urban sophistication.", grad:"from-gray-700 to-slate-900",
          icon:"M5 5h4v4H5zM5 13h4v4H5zM13 5h6v4h-6zM13 13h6v4h-6z" },
        { title:"Luxury Contemporary", desc:"Premium finishes and statement pieces.", grad:"from-purple-600 to-pink-600",
          icon:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.86L12 17.77l-6.18 3.23L7 14.14 2 9.27l6.91-1.01z" },
      ];

      designs.forEach((d, i)=>{
        const card = document.createElement("div");
        card.className = "card-hover bg-white rounded-2xl overflow-hidden shadow-xl border border-gray-100";
        card.innerHTML = `
          <div class="h-64 bg-gradient-to-br ${d.grad} relative">
            <div class="absolute inset-0 bg-black/20"></div>
            <div class="absolute top-6 right-6 bg-white/20 backdrop-blur rounded-xl px-3 py-1 text-white font-semibold">Design ${i+1}</div>
            <div class="absolute inset-0 flex items-center justify-center">
              <div class="w-24 h-24 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center float">
                <svg class="w-12 h-12 text-white" viewBox="0 0 24 24" fill="currentColor"><path d="${d.icon}"/></svg>
              </div>
            </div>
          </div>
          <div class="p-7">
            <h3 class="text-2xl font-bold text-gray-800 mb-2">${d.title}</h3>
            <p class="text-gray-600 mb-5">${d.desc}</p>
            <div class="flex items-center justify-between">
              <button class="sel px-5 py-3 rounded-xl text-white font-semibold bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700">Select Design</button>
              <button class="det text-purple-600 hover:text-purple-700 font-semibold inline-flex items-center gap-1">
                View Details
                <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4l1.41 1.41L8.83 10H20v2H8.83l4.58 4.59L12 18l-8-8 8-8z"/></svg>
              </button>
            </div>
          </div>`;
        grid.appendChild(card);

        card.querySelector(".sel").addEventListener("click", async ()=>{
          alert(`Selected: ${d.title}`);
          await sendToN8N("select_proposal",{ index:i+1, title:d.title });
        });
        card.querySelector(".det").addEventListener("click", ()=>{
          alert(`Details for ${d.title} (3D, materials, cost, etc.)`);
        });
      });
    }

    document.getElementById("btn-regenerate").addEventListener("click", async ()=>{
      document.getElementById("loading").classList.remove("hidden");
      document.getElementById("proposals").classList.add("hidden");
      await sendToN8N("regenerate",{});
      setTimeout(()=>showProposals(), 1800);
    });

    document.getElementById("btn-download").addEventListener("click", async (e)=>{
      const btn = e.currentTarget;
      const old = btn.innerHTML;
      btn.innerHTML = `<span class="inline-flex items-center gap-2"><span class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>Generating…</span>`;
      btn.disabled = true;
      await sendToN8N("download_pdf",{});
      setTimeout(()=>{
        btn.innerHTML = old;
        btn.disabled = false;
        alert("PDF is prepared (demo).");
      }, 1800);
    });

    // بدء على الخطوة 1
    setStep(1);
  </script>
</body>
</html>
